
If you’ve ever looked at Kerberos and thought “this is wizard magic written in alien hieroglyphs,” you’re not alone. I felt exactly the same the first time. But I promise: once we break it into bite-sized, real-life pieces, it suddenly starts making sense.

Think of Kerberos like a super-secure amusement park ticket system. You don’t want to show your passport and pay cash every single time you want to ride a rollercoaster. Instead, the park gives you one “all-day pass” (TGT) after checking your ID once, and then you flash a smaller “ride ticket” (service ticket) for each attraction. That’s basically Kerberos in one sentence.

You hear words like:

- TGT
- TGS
- PAC
- Authenticators
- Session keys
    
…and your brain quietly disconnects.

What finally made Kerberos click for me was realizing this:

> **Kerberos is not magic.  It’s just a very strict system for proving identity _without re-sending passwords_.**


Let’s walk through it slowly, like we’re sitting together with coffee and I’m drawing on a napkin.


## The Core Idea (Before Any Jargon)

Kerberos exists to solve three problems:

1. Users shouldn’t send passwords over the network repeatedly
2. Services shouldn’t store user passwords
3. The network might be hostile (sniffing, replay, tampering)
    
So Kerberos says:

> “We’ll use **tickets** instead of passwords,  and we’ll let a **trusted third party** vouch for everyone.”

That trusted third party is the **KDC**.


### The Main Players (The Cast of Characters)

- **You (the User / Principal)**:  You want to prove who you are and then access stuff (file share, SQL server, etc.) without typing your password 50 times.

- **Key Distribution Center (KDC)**: The trusted security booth at the park entrance. In Windows = your Domain Controller (DC). It has two parts inside:
    - **Authentication Server (AS)** → checks your ID the first time (“Are you really who you say you are?”)
    - **Ticket-Granting Server (TGS)** → gives you ride tickets later (“Okay, what service do you want access to?”)

- **krbtgt account**: The super-secret master key of the entire park. Its password hash is used to sign/encrypt all the big tickets (TGTs). If someone gets this hash → they own the domain (`Golden Ticket attack`).

- **TGT (Ticket-Granting Ticket)**: Your “all-day wristband”. You get this once after logging in. It proves you already passed the ID check. It enables **Single Sign-On**. You authenticate **once**, then reuse the TGT to request other tickets. This is why dumping TGTs is so powerful.

- **Service Ticket (TGS ticket)**: The little ticket you show to ride a specific rollercoaster (e.g., SMB share, SQL service). You get a new one for every different service.  It is **service-specific**. This is what Kerberoasting targets.

- **SPN (Service Principal Name)**: The name of the ride. Example: MSSQLSvc/sqlserver.hackme.com:1433 Every service that wants Kerberos auth needs an SPN registered to an account.

- **PAC (Privileged Attribute Certificate)** A little ID card stapled to your ticket. It says “this person is in Domain Admins, Finance Team, etc.” The service trusts this info (unless PAC validation is forced). The **PAC** contains: User RID, Group memberships, Privileges, UAC flags
   
  Instead of the service asking AD every time: “Is this user an admin?” …the answer is **embedded inside the ticket**.

Now when we understood everything. Let's see the Normal Login Flow:

1. **You arrive at the park (first login of the day):** You say: “Hey KDC, it’s me! I want my all-day wristband (TGT).” 
  → You send **AS-REQ** (includes your name + encrypted timestamp using your password hash)

2.  **KDC checks your ID:** KDC looks up your password hash in AD, decrypts your timestamp. If it matches → “Yep, it’s really you!” 
    KDC creates:
    - A TGT (encrypted with krbtgt hash)
    - A session key (sent back to you encrypted with _your_ hash) → You get **AS-REP** with TGT + session key

3. **You want to ride the SQL rollercoaster:** You go to the TGS booth (still the KDC) and show:
    - Your TGT
    - A little note (“authenticator”) proving you’re the owner of the TGT 
      → You send **TGS-REQ**

4. **KDC gives you the ride ticket:** KDC decrypts TGT (using krbtgt hash), checks your authenticator, looks up the SPN → knows which account owns the SQL service.  
   Creates a **service ticket** (encrypted with the SQL service account’s hash) Also gives you a new session key for talking to SQL. 
    → You get **TGS-REP**

5.  **You go to the ride (SQL server):** You hand the service ticket + another authenticator to the SQL server. SQL decrypts the ticket (using its own hash), checks the authenticator, reads the PAC → “Oh, this person is allowed!” 
    No more password typing!

#### Why Attackers Love (and Hate) Kerberos

**Love it because:**

- You can abuse weak configs without ever knowing the plaintext password
- Tickets can be forged, stolen, renewed, or cracked offline

**Hate it because:**

- Everything is time-sensitive & encrypted with strong keys (AES256 by default)
- Modern Windows (2026) has many protections: PAC validation, RC4 disabled, Kerberos armoring, etc.



##### Quick Cheat Sheet of Famous Kerberos Attacks

| Attack Name     | What it abuses                           | Privilege needed | Crackable?     | Detection risk |
| --------------- | ---------------------------------------- | ---------------- | -------------- | -------------- |
| AS-REP Roasting | Pre-auth disabled accounts               | Any domain user  | Yes (fast RC4) | Medium         |
| Kerberoasting   | Service accounts with SPNs               | Any domain user  | Yes (RC4/AES)  | Medium-High    |
| Pass-the-Ticket | Stolen TGT or service ticket from memory | High/SYSTEM      | No (reuse)     | Low            |
| Golden Ticket   | Forge TGT using krbtgt hash              | krbtgt hash      | No (forge)     | Very High      |
| Silver Ticket   | Forge service ticket using service hash  | Service hash     | No (forge)     | Medium         |
| UnPAC-the-Hash  | Forge PAC + get NTLM hash                | High             | Yes (NTLM)     | Medium-High    |

